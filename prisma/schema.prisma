generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. Stock (ë²¼ ì¬ê³ )
model Stock {
  id          Int           @id @default(autoincrement())
  bagNo       Int           // í†¤ë°± ë²ˆí˜¸
  farmerName  String        // ë†ê°€ëª…
  variety     String        // í’ˆì¢…
  productionYear Int        @default(2024) // ìƒì‚°ë…„ë„
  certType    String        // ì¸ì¦
  weightKg    Float         // ì…ê³  ì¤‘ëŸ‰
  status      String        // AVAILABLE / CONSUMED
  batchId     Int?          // ì–´ë–¤ ë„ì • ì‘ì—…ì— íˆ¬ì…ë˜ì—ˆëŠ”ì§€
  batch       MillingBatch? @relation(fields: [batchId], references: [id])
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

// 2. MillingBatch (ë„ì • ì‘ì—… ë©”ì¸)
model MillingBatch {
  id             Int                    @id @default(autoincrement())
  date           DateTime               @default(now())
  title          String
  millingType    String                 @default("ë°±ë¯¸") // ë„ì • êµ¬ë¶„ (ë°±ë¯¸, í˜„ë¯¸, ì¹ ë¶„ë„ë¯¸, ê¸°íƒ€)
  totalInputKg   Float                  
  stocks         Stock[]                // íˆ¬ì…ëœ ë²¼ ë¦¬ìŠ¤íŠ¸
  outputs        MillingOutputPackage[] // ìƒì‚°ëœ í¬ì¥ ë¦¬ìŠ¤íŠ¸
  isClosed       Boolean                @default(false)
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt
}

// 3. MillingOutputPackage (í¬ì¥ ìƒì„¸)
model MillingOutputPackage {
  id            Int           @id @default(autoincrement())
  batchId       Int
  batch         MillingBatch  @relation(fields: [batchId], references: [id])
  packageType   String        // '20kg', '10kg', '5kg', 'Tonbag', etc.
  weightPerUnit Float         
  count         Int           
  totalWeight   Float         
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

// 4. User (ì‚¬ìš©ì ê³„ì •)
model User {
  id          Int      @id @default(autoincrement())
  username    String   @unique // ì•„ì´ë”” (astraverse)
  password    String   // ë¹„ë°€ë²ˆí˜¸ (Hashed)
  name        String   // ì´ë¦„ (ë¬¸í¬ì¤€)
  department  String?  // ë¶€ì„œ (ê³µì¥)
  position    String?  // ì§ì±… (ì£¼ì„)
  phone       String?  // ì—°ë½ì²˜ (01086549345)
  role        String   @default("USER") // ADMIN, USER
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// 5. Variety (Ç°Á¾ °ü¸®)
model Variety {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
